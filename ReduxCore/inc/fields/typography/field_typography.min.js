!function(e){"use strict";redux.field_objects=redux.field_objects||{},redux.field_objects.typography=redux.field_objects.typography||{};var t=[],a=!1,r={width:"100%",allowClear:!0,theme:"classic"};e(document).ready(function(){}),redux.field_objects.typography.init=function(s,l){s||(s=e(document).find(".redux-group-tab:visible").find(".redux-container-typography:visible")),e(s).each(function(){var s=e(this),l=s;if(s.hasClass("redux-field-container")||(l=s.parents(".redux-field-container:first")),!l.is(":hidden")&&l.hasClass("redux-field-init")){l.removeClass("redux-field-init");var p;s.each(function(){e(this).find(".redux-typography-container").each(function(){var l=e(this).find(".redux-typography-family");void 0===l.attr("data-value")?l=e(this):""!==l.attr("data-value")&&e(l).val(l.attr("data-value")).trigger("change");var o=e(this).find(".select2_params");if(o.size()>0){var i=o.val();i=JSON.parse(i),r=e.extend({},r,i)}p=Boolean(e(this).find(".redux-font-clear").val());var y=[{id:"none",text:"none"}],d=e(this).find(".redux-typography-family").parents(".redux-container-typography:first").attr("data-id"),n=e("#"+d+" .redux-typography-font-family").data("user-fonts");n=n?1:0;var u=e("#"+d+" .redux-typography-google").val();u=u?1:0;var h=[];if(void 0!==redux.customfonts&&h.push(redux.customfonts),void 0!==redux.stdfonts&&0===n&&h.push(redux.stdfonts),1==n){var f=[];for(var g in redux.typography[d]){var c=redux.typography[d].std_font;for(var v in c)c.hasOwnProperty(v)&&f.push({id:v,text:v,"data-google":"false"})}var x={text:"Standard Fonts",children:f};h.push(x)}(1==u||u===!0&&void 0!==redux.googlefonts)&&h.push(redux.googlefonts),y=h;var b=e(this).find(".redux-typography-family").attr("placeholder"),m=e(this).find(".redux-typography-family").attr("data-value"),w=r;w.data=y,w.placeholder=b,w.allowClear=p,e(this).find(".redux-typography-family").select2(w),w.data=null,w.placeholder=null,e(this).find(".redux-typography-family").val(m).trigger("change");var _=s.find(".redux-typography-family");if(!_.hasClass("redux-typography-family")){var w=r,b=e(this).find(".redux-typography-align").attr("placeholder");w.placeholder=b,s.find(".redux-typography-style").select2(w),w.placeholder=null}var w=r,b=e(this).find(".redux-typography-align").attr("placeholder");w.placeholder=b,e(this).find(".redux-typography-align").select2(w),w.placeholder=null;var w=r,b=e(this).find(".redux-typography-family-backup").attr("placeholder");w.placeholder=b,e(this).find(".redux-typography-family-backup").select2(w),w.placeholder=null,s.find(".redux-typography-transform, .redux-typography-font-variant, .redux-typography-decoration").select2(r),redux.field_objects.typography.select(l,!0,!1,null,!0),e(this).find(".redux-typography-family, .redux-typography-family-backup, .redux-typography-style, .redux-typography-subsets, .redux-typography-align").on("change",function(r){var s=e(this).attr("id");if(e(this).hasClass("redux-typography-family")){if(e("#"+s).val()){var l=e(this).select2("data");console.log(l);var p;p=l?l[0].text:null;e("#"+s);e("#"+s).attr("data-value",p),t=l[0],a=!0,redux.field_objects.typography.select(e("#"+s),!0,!1,p,!0)}}else{var r=e("#"+s).val();e("#"+s).attr("data-value",r),(e(this).hasClass("redux-typography-align")||e(this).hasClass("redux-typography-subsets")||e(this).hasClass("redux-typography-family-backup"))&&(e("#"+s+' option[selected="selected"]').removeAttr("selected"),e("#"+s+' option[value="'+r+'"]').attr("selected","selected")),e(this).hasClass("redux-typography-subsets")&&e("#"+s).siblings(".typography-subsets").val(r),redux.field_objects.typography.select(e(this),!0,!1,null,!1)}}),e(this).find(".redux-typography-size, .redux-typography-height, .redux-typography-word, .redux-typography-letter, .redux-typography-transform, .redux-typography-font-variant, .redux-typography-decoration").keyup(function(){redux.field_objects.typography.select(e(this).parents(".redux-container-typography:first"))}),e(this).find(".redux-typography-color").wpColorPicker({change:function(t,a){e(this).val(a.color.toString()),redux.field_objects.typography.select(e(this).parents(".redux-container-typography:first"))}}),e(this).find(".redux-typography-size").numeric({allowMinus:!1}),e(this).find(".redux-typography-height, .redux-typography-word, .redux-typography-letter").numeric({allowMinus:!0}),e(this).find(".redux-typography").on("select2:unselecting",function(t,a){console.log("unselecting 1");var r=e(this).attr("id");e("#"+r).attr("data-value",""),e(this).hasClass("redux-typography-family")?(e(this).val(null).trigger("change"),redux.field_objects.typography.select(e("#"+r),!0,!1,null,!0)):((e(this).hasClass("redux-typography-align")||e(this).hasClass("redux-typography-subsets")||e(this).hasClass("redux-typography-family-backup"))&&e("#"+r+' option[selected="selected"]').removeAttr("selected"),e(this).hasClass("redux-typography-subsets")&&e("#"+r).siblings(".typography-subsets").val(""),e(this).hasClass("redux-typography-family-backup")&&e("#"+r).val(null).trigger("change"),redux.field_objects.typography.select(e(this),!0,!1,null,!1)),console.log("unselecting 2")}),window.onbeforeunload=null})})}})},redux.field_objects.typography.size=function(e){var a,t=0;for(a in e)e.hasOwnProperty(a)&&t++;return t},redux.field_objects.typography.makeBool=function(e){return"false"==e||"0"==e||e===!1||0===e?!1:"true"==e||"1"==e||e===!0||1==e?!0:void 0},redux.field_objects.typography.contrastColour=function(e){var t="#444444";if(""!==e){e=e.replace("#","");var a=parseInt(e.substr(0,2),16),r=parseInt(e.substr(2,2),16),s=parseInt(e.substr(4,2),16),l=(299*a+587*r+114*s)/1e3;t=l>=128?"#444444":"#ffffff"}return t},redux.field_objects.typography.select=function(s,l,p,o,i){var y;y=e(s).parents(".redux-container-typography:first").attr("data-id"),void 0===y&&(y=e(s).attr("data-id"));var u=(e(s).parents(".redux-container-typography:first"),e("#"+y+"-family").val());u||(u=null),o&&(u=o);var h=e("#"+y+" select.redux-typography-family-backup").val(),f=e("#"+y+" .redux-typography-size").val(),g=e("#"+y+" .redux-typography-height").val(),c=e("#"+y+" .redux-typography-word").val(),v=e("#"+y+" .redux-typography-letter").val(),x=e("#"+y+" select.redux-typography-align").val(),b=e("#"+y+" select.redux-typography-transform").val(),m=e("#"+y+" select.redux-typography-font-variant").val(),w=e("#"+y+" select.redux-typography-decoration").val(),_=e("#"+y+" select.redux-typography-style").val(),C=e("#"+y+" select.redux-typography-subsets").val(),j=e("#"+y+" .redux-typography-color").val(),k=e("#"+y).data("units");if(i){var z;a===!0?(z=redux.field_objects.typography.makeBool(t["data-google"]),e("#"+y+" .redux-typography-google-font").val(z)):z=redux.field_objects.typography.makeBool(e("#"+y+" .redux-typography-google-font").val()),e("#"+y).hasClass("typography-initialized")||(_=e("#"+y+" select.redux-typography-style").attr("data-value"),C=e("#"+y+" select.redux-typography-subsets").attr("data-value"),""!==_&&(_=String(_)),void 0!==typeof C&&(C=String(C))),void 0===redux.fonts.google&&(z=!1);var I="";z===!0&&u in redux.fonts.google?(I=redux.fonts.google[u],console.log("details "+I)):I={400:"Normal 400",700:"Bold 700","400italic":"Normal 400 Italic","700italic":"Bold 700 Italic"},e(s).hasClass("redux-typography-subsets")&&e("#"+y+" input.typography-subsets").val(C)}if(e(s).hasClass("redux-typography-family")){var B='<option value=""></option>';if(z===!0){var O="";e.each(I.variants,function(e,t){t.id===_||1===redux.field_objects.typography.size(I.variants)?(O=' selected="selected"',_=t.id):O="",B+='<option value="'+t.id+'"'+O+">"+t.name.replace(/\+/g," ")+"</option>"}),p&&e("#"+y+" .redux-typography-style").select2("destroy"),e("#"+y+" .redux-typography-style").html(B);var S=e("#"+y+" .redux-typography-style").attr("placeholder"),F=r;F.placeholder=S,e("#"+y+" .redux-typography-style").select2(F),F.placeholder=null,O="",B='<option value=""></option>',e.each(I.subsets,function(t,a){a.id===C||1===redux.field_objects.typography.size(I.subsets)?(O=' selected="selected"',C=a.id,e("#"+y+" input.typography-subsets").val(C)):O="",B+='<option value="'+a.id+'"'+O+">"+a.name.replace(/\+/g," ")+"</option>"}),p&&e("#"+y+" .redux-typography-subsets").select2("destroy"),e("#"+y+" .redux-typography-subsets").html(B),S=e("#"+y+" .redux-typography-subsets").attr("placeholder");var F=r;F.placeholder=S,e("#"+y+" .redux-typography-subsets").select2(F),F.placeholder=null,e("#"+y+" .redux-typography-subsets").parent().fadeIn("fast"),e("#"+y+" .typography-family-backup").fadeIn("fast")}else if(I){e.each(I,function(t,a){t===_||"normal"===t?(O=' selected="selected"',e("#"+y+" .typography-style select2-selection__rendered").text(a)):O="",B+='<option value="'+t+'"'+O+">"+a.replace("+"," ")+"</option>"}),p&&e("#"+y+" .redux-typography-style").select2("destroy"),e("#"+y+" .redux-typography-style").html(B),S=e("#"+y+" .redux-typography-style").attr("placeholder");var F=r;F.placeholder=S,e("#"+y+" .redux-typography-style").select2(F),F.placeholder=null,e("#"+y+" .redux-typography-subsets").parent().fadeOut("fast"),e("#"+y+" .typography-family-backup").fadeOut("fast")}e("#"+y+" .redux-typography-font-family").val(u)}else e(s).hasClass("redux-typography-family-backup")&&""!==h&&e("#"+y+" .redux-typography-font-family-backup").val(h);i&&(0===e("#"+y+" select.redux-typography-style option[value='"+_+"']").length?(_="",e("#"+y+" select.redux-typography-style").val("").trigger("change")):"400"===_&&e("#"+y+" select.redux-typography-style").val(_).trigger("change"),0===e("#"+y+" select.redux-typography-subsets option[value='"+C+"']").length&&(C="",e("#"+y+" select.redux-typography-subsets").val("").trigger("change"),e("#"+y+" input.typography-subsets").val(C)));var N="style_link_"+y;if(e("."+N).remove(),null!==u&&"inherit"!==u&&e("#"+y).hasClass("typography-initialized")){var P=u.replace(/\s+/g,"+");if(z===!0){var W=P;_&&""!==_&&(W+=":"+_.replace(/\-/g," ")),C&&""!==C&&(W+="&subset="+C),a===!1&&"undefined"!=typeof WebFont&&WebFont&&WebFont.load({google:{families:[W]}}),e("#"+y+" .redux-typography-google").val(!0)}else e("#"+y+" .redux-typography-google").val(!1)}if(-1!==_.indexOf("italic")?(e("#"+y+" .typography-preview").css("font-style","italic"),e("#"+y+" .typography-font-style").val("italic"),_=_.replace("italic","")):(e("#"+y+" .typography-preview").css("font-style","normal"),e("#"+y+" .typography-font-style").val("")),e("#"+y+" .typography-font-weight").val(_),g||(g=f),""===f||void 0===f?e("#"+y+" .typography-font-size").val(""):e("#"+y+" .typography-font-size").val(f+k),""===g||void 0===g?e("#"+y+" .typography-line-height").val(""):e("#"+y+" .typography-line-height").val(g+k),""===c||void 0===c?e("#"+y+" .typography-word-spacing").val(""):e("#"+y+" .typography-word-spacing").val(c+k),""===v||void 0===v?e("#"+y+" .typography-letter-spacing").val(""):e("#"+y+" .typography-letter-spacing").val(v+k),e("#"+y).hasClass("typography-initialized")){var A=e("#"+y+" .typography-preview").data("preview-size");"0"==A&&e("#"+y+" .typography-preview").css("font-size",f+k),e("#"+y+" .typography-preview").css("font-weight",_),e("#"+y+" .typography-preview").css("font-family",u+", sans-serif"),"none"===u&&""===u&&e("#"+y+" .typography-preview").css("font-family","inherit"),e("#"+y+" .typography-preview").css("line-height",g+k),e("#"+y+" .typography-preview").css("word-spacing",c+k),e("#"+y+" .typography-preview").css("letter-spacing",v+k),j&&(e("#"+y+" .typography-preview").css("color",j),e("#"+y+" .typography-preview").css("background-color",redux.field_objects.typography.contrastColour(j))),e("#"+y+" .typography-style select2-selection__rendered").text(e("#"+y+" .redux-typography-style option:selected").text()),e("#"+y+" .typography-script select2-selection__rendered").text(e("#"+y+" .redux-typography-subsets option:selected").text()),x&&e("#"+y+" .typography-preview").css("text-align",x),b&&e("#"+y+" .typography-preview").css("text-transform",b),m&&e("#"+y+" .typography-preview").css("font-variant",m),w&&e("#"+y+" .typography-preview").css("text-decoration",w),e("#"+y+" .typography-preview").slideDown()}e("#"+y).hasClass("typography-initialized")||e("#"+y).addClass("typography-initialized"),a=!1,l||redux_change(s)}}(jQuery);